---
description: This hook creates detailed documentation with technical implementation details, extracts information from task files, and updates the project documentation index.
type: task_status_change
trigger: completed
priority: 25
enabled: true
---

# Comprehensive Documentation Integration

```bash
#!/bin/bash

# Variables
TASK_ID="{{task.id}}"
TASK_TITLE="{{task.title}}"
TASK_FEATURE="{{task.feature}}"
TASK_STATUS="{{task.status}}"
TASK_COMMIT_TYPE="{{task.commit_type}}"
TASK_PATH="{{task.path}}"
TIMESTAMP=$(date -u +"%Y-%m-%d %H:%M:%S UTC")
VERSION_FILE=".vscode/rules/.magic-vibe/version.json"

# Function to get version from JSON file
get_version() {
    local type=$1
    local field=$2
    if [ -f "$VERSION_FILE" ]; then
        python3 -c "
import json
try:
    with open('$VERSION_FILE', 'r') as f:
        data = json.load(f)
    print(data.get('$type', {}).get('$field', 'unknown'))
except:
    print('unknown')
"
    else
        echo "unknown"
    fi
}

# Function to update version in JSON file
update_version() {
    local type=$1
    local field=$2
    local value=$3
    
    if [ ! -f "$VERSION_FILE" ]; then
        echo "Version file not found: $VERSION_FILE"
        return 1
    fi
    
    python3 -c "
import json
try:
    with open('$VERSION_FILE', 'r') as f:
        data = json.load(f)
    
    if '$type' not in data:
        data['$type'] = {}
    
    data['$type']['$field'] = '$value'
    
    with open('$VERSION_FILE', 'w') as f:
        json.dump(data, f, indent=2)
except Exception as e:
    print(f'Error: {e}')
"
}

# Function to increment version number
increment_version() {
    local version=$1
    IFS='.' read -ra VERSION_PARTS <<< "$version"
    local major=${VERSION_PARTS[0]:-0}
    local minor=${VERSION_PARTS[1]:-0}
    local patch=${VERSION_PARTS[2]:-0}
    patch=$((patch + 1))
    echo "${major}.${minor}.${patch}"
}

# Update documentation version automatically
current_doc_version=$(get_version "documentation" "version")
new_doc_version=$(increment_version "$current_doc_version")
update_version "documentation" "version" "$new_doc_version"
update_version "documentation" "last_auto_generation" "$(date -u +"%Y-%m-%dT%H:%M:%SZ")"

# Increment generation count
current_count=$(get_version "documentation" "generation_count")
new_count=$((current_count + 1))
update_version "documentation" "generation_count" "$new_count"

# Get project version for documentation
project_version=$(get_version "project" "version")
magic_vibe_version=$(get_version "task_magic" "system_version")

# Create docs directory structure
mkdir -p docs/en/tasks docs/ru/tasks docs/en/features docs/ru/features

# Extract task details from task file if it exists
TASK_DESCRIPTION=""
TASK_DETAILS=""
TEST_STRATEGY=""

if [ -f "$TASK_PATH" ]; then
    # Extract sections from task file
    TASK_DESCRIPTION=$(sed -n '/^## Description$/,/^## /p' "$TASK_PATH" | head -n -1 | tail -n +2)
    TASK_DETAILS=$(sed -n '/^## Details$/,/^## /p' "$TASK_PATH" | head -n -1 | tail -n +2)
    TEST_STRATEGY=$(sed -n '/^## Test Strategy$/,/^## /p' "$TASK_PATH" | head -n -1 | tail -n +2)
fi

# Generate comprehensive English documentation
cat > "docs/en/tasks/task-${TASK_ID}-${TASK_FEATURE,,}.md" << EOF
# ${TASK_TITLE}

**Task ID:** ${TASK_ID}  
**Feature:** ${TASK_FEATURE}  
**Status:** ${TASK_STATUS}  
**Commit Type:** ${TASK_COMMIT_TYPE}  
**Completed:** ${TIMESTAMP}  
**Source:** ${TASK_PATH}

## Version Information

**Project Version:** ${project_version}  
**Documentation Version:** ${new_doc_version}  
**Magic Vibe System:** v${magic_vibe_version}  
**Generation #:** ${new_count}

## Overview

${TASK_DESCRIPTION:-"Task completed successfully as part of the ${TASK_FEATURE} feature implementation."}

## Implementation Details

${TASK_DETAILS:-"Implementation details were completed according to task specifications."}

## Testing and Verification

${TEST_STRATEGY:-"Task was completed and verified according to the defined acceptance criteria."}

## Technical Changes

- Task implementation completed
- Code changes committed to repository
- Documentation automatically generated
- Integration with existing codebase verified

## Related Documentation

- [Feature Documentation](../features/${TASK_FEATURE,,}.md)
- [Project Overview](../README.md)
- [Russian Version](../../ru/tasks/task-${TASK_ID}-${TASK_FEATURE,,}.md)

---

*Auto-generated by Magic Vibe system on ${TIMESTAMP}*
EOF

# Generate comprehensive Russian documentation
cat > "docs/ru/tasks/task-${TASK_ID}-${TASK_FEATURE,,}.md" << EOF
# ${TASK_TITLE}

**ID Ð·Ð°Ð´Ð°Ñ‡Ð¸:** ${TASK_ID}  
**Ð¤ÑƒÐ½ÐºÑ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ:** ${TASK_FEATURE}  
**Ð¡Ñ‚Ð°Ñ‚ÑƒÑ:** ${TASK_STATUS}  
**Ð¢Ð¸Ð¿ ÐºÐ¾Ð¼Ð¼Ð¸Ñ‚Ð°:** ${TASK_COMMIT_TYPE}  
**Ð—Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¾:** ${TIMESTAMP}  
**Ð˜ÑÑ‚Ð¾Ñ‡Ð½Ð¸Ðº:** ${TASK_PATH}

## Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾ Ð²ÐµÑ€ÑÐ¸Ð¸

**Ð’ÐµÑ€ÑÐ¸Ñ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°:** ${project_version}  
**Ð’ÐµÑ€ÑÐ¸Ñ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ð¸:** ${new_doc_version}  
**Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Magic Vibe:** v${magic_vibe_version}  
**ÐÐ¾Ð¼ÐµÑ€ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ð¸:** ${new_count}

## ÐžÐ±Ð·Ð¾Ñ€

${TASK_DESCRIPTION:-"Ð—Ð°Ð´Ð°Ñ‡Ð° ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð° Ð² Ñ€Ð°Ð¼ÐºÐ°Ñ… Ñ€ÐµÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾ÑÑ‚Ð¸ ${TASK_FEATURE}."}

## Ð”ÐµÑ‚Ð°Ð»Ð¸ Ñ€ÐµÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸

${TASK_DETAILS:-"Ð”ÐµÑ‚Ð°Ð»Ð¸ Ñ€ÐµÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸ Ð±Ñ‹Ð»Ð¸ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ñ‹ ÑÐ¾Ð³Ð»Ð°ÑÐ½Ð¾ ÑÐ¿ÐµÑ†Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸ÑÐ¼ Ð·Ð°Ð´Ð°Ñ‡Ð¸."}

## Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¸ Ð²ÐµÑ€Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ñ

${TEST_STRATEGY:-"Ð—Ð°Ð´Ð°Ñ‡Ð° Ð±Ñ‹Ð»Ð° Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð° Ð¸ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐµÐ½Ð° ÑÐ¾Ð³Ð»Ð°ÑÐ½Ð¾ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð½Ñ‹Ð¼ ÐºÑ€Ð¸Ñ‚ÐµÑ€Ð¸ÑÐ¼ Ð¿Ñ€Ð¸ÐµÐ¼ÐºÐ¸."}

## Ð¢ÐµÑ…Ð½Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ

- Ð ÐµÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð·Ð°Ð´Ð°Ñ‡Ð¸ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð°
- Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð² ÐºÐ¾Ð´Ðµ Ð·Ð°Ñ„Ð¸ÐºÑÐ¸Ñ€Ð¾Ð²Ð°Ð½Ñ‹ Ð² Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¸
- Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ ÑÐ³ÐµÐ½ÐµÑ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð°
- Ð˜Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ Ñ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰ÐµÐ¹ ÐºÐ¾Ð´Ð¾Ð²Ð¾Ð¹ Ð±Ð°Ð·Ð¾Ð¹ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐµÐ½Ð°

## Ð¡Ð²ÑÐ·Ð°Ð½Ð½Ð°Ñ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ

- [Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾ÑÑ‚Ð¸](../features/${TASK_FEATURE,,}.md)
- [ÐžÐ±Ð·Ð¾Ñ€ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°](../README.md)
- [ÐÐ½Ð³Ð»Ð¸Ð¹ÑÐºÐ°Ñ Ð²ÐµÑ€ÑÐ¸Ñ](../../en/tasks/task-${TASK_ID}-${TASK_FEATURE,,}.md)

---

*ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ ÑÐ³ÐµÐ½ÐµÑ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¾ ÑÐ¸ÑÑ‚ÐµÐ¼Ð¾Ð¹ Magic Vibe v${magic_vibe_version} ${TIMESTAMP}*
EOF

# Update English documentation index
if ! grep -q "## Task ${TASK_ID}:" "docs/en/README.md"; then
    sed -i "/## Recent Updates/a\\
\\
### Task ${TASK_ID}: ${TASK_TITLE}\\
**Completed:** ${TIMESTAMP}  \\
**Feature:** ${TASK_FEATURE}  \\
**Type:** ${TASK_COMMIT_TYPE}  \\
**Documentation Version:** ${new_doc_version}  \\
\\
[View Documentation](tasks/task-${TASK_ID}-${TASK_FEATURE,,}.md)" "docs/en/README.md"
fi

# Update Russian documentation index
if ! grep -q "## Ð—Ð°Ð´Ð°Ñ‡Ð° ${TASK_ID}:" "docs/ru/README.md"; then
    sed -i "/## ÐŸÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ/a\\
\\
### Ð—Ð°Ð´Ð°Ñ‡Ð° ${TASK_ID}: ${TASK_TITLE}\\
**Ð—Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¾:** ${TIMESTAMP}  \\
**Ð¤ÑƒÐ½ÐºÑ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ:** ${TASK_FEATURE}  \\
**Ð¢Ð¸Ð¿:** ${TASK_COMMIT_TYPE}  \\
**Ð’ÐµÑ€ÑÐ¸Ñ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ð¸:** ${new_doc_version}  \\
\\
[ÐŸÐ¾ÑÐ¼Ð¾Ñ‚Ñ€ÐµÑ‚ÑŒ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸ÑŽ](tasks/task-${TASK_ID}-${TASK_FEATURE,,}.md)" "docs/ru/README.md"
fi

echo "âœ… Comprehensive documentation generated for task ${TASK_ID}: ${TASK_TITLE}"
echo "ðŸ“ English: docs/en/tasks/task-${TASK_ID}-${TASK_FEATURE,,}.md"
echo "ðŸ“ Russian: docs/ru/tasks/task-${TASK_ID}-${TASK_FEATURE,,}.md"
echo "ðŸ“ Documentation indexes updated"
echo "ðŸ·ï¸ Documentation version: ${new_doc_version} (Generation #${new_count})"
echo "ðŸ“Š Project version: ${project_version}"
```
