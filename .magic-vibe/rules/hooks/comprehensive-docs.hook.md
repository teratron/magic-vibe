---
description: This hook creates detailed documentation with technical implementation details, extracts information from task files, and updates the project documentation index.
type: task_status_change
trigger: completed
priority: 25
enabled: true
---

# Comprehensive Documentation Integration

```bash
#!/bin/bash

# Variables
TASK_ID="{{task.id}}"
TASK_TITLE="{{task.title}}"
TASK_FEATURE="{{task.feature}}"
TASK_STATUS="{{task.status}}"
TASK_COMMIT_TYPE="{{task.commit_type}}"
TASK_PATH="{{task.path}}"
TIMESTAMP=$(date -u +"%Y-%m-%d %H:%M:%S UTC")
VERSION_FILE=".vscode/rules/.magic-vibe/version.json"

# Function to get version from JSON file
get_version() {
    local type=$1
    local field=$2
    if [ -f "$VERSION_FILE" ]; then
        python3 -c "
import json
try:
    with open('$VERSION_FILE', 'r') as f:
        data = json.load(f)
    print(data.get('$type', {}).get('$field', 'unknown'))
except:
    print('unknown')
"
    else
        echo "unknown"
    fi
}

# Function to update version in JSON file
update_version() {
    local type=$1
    local field=$2
    local value=$3
    
    if [ ! -f "$VERSION_FILE" ]; then
        echo "Version file not found: $VERSION_FILE"
        return 1
    fi
    
    python3 -c "
import json
try:
    with open('$VERSION_FILE', 'r') as f:
        data = json.load(f)
    
    if '$type' not in data:
        data['$type'] = {}
    
    data['$type']['$field'] = '$value'
    
    with open('$VERSION_FILE', 'w') as f:
        json.dump(data, f, indent=2)
except Exception as e:
    print(f'Error: {e}')
"
}

# Function to increment version number
increment_version() {
    local version=$1
    IFS='.' read -ra VERSION_PARTS <<< "$version"
    local major=${VERSION_PARTS[0]:-0}
    local minor=${VERSION_PARTS[1]:-0}
    local patch=${VERSION_PARTS[2]:-0}
    patch=$((patch + 1))
    echo "${major}.${minor}.${patch}"
}

# Update documentation version automatically
current_doc_version=$(get_version "documentation" "version")
new_doc_version=$(increment_version "$current_doc_version")
update_version "documentation" "version" "$new_doc_version"
update_version "documentation" "last_auto_generation" "$(date -u +"%Y-%m-%dT%H:%M:%SZ")"

# Increment generation count
current_count=$(get_version "documentation" "generation_count")
new_count=$((current_count + 1))
update_version "documentation" "generation_count" "$new_count"

# Get project version for documentation
project_version=$(get_version "project" "version")
magic_vibe_version=$(get_version "task_magic" "system_version")

# Create docs directory structure
mkdir -p docs/en/tasks docs/ru/tasks docs/en/features docs/ru/features

# Extract task details from task file if it exists
TASK_DESCRIPTION=""
TASK_DETAILS=""
TEST_STRATEGY=""

if [ -f "$TASK_PATH" ]; then
    # Extract sections from task file
    TASK_DESCRIPTION=$(sed -n '/^## Description$/,/^## /p' "$TASK_PATH" | head -n -1 | tail -n +2)
    TASK_DETAILS=$(sed -n '/^## Details$/,/^## /p' "$TASK_PATH" | head -n -1 | tail -n +2)
    TEST_STRATEGY=$(sed -n '/^## Test Strategy$/,/^## /p' "$TASK_PATH" | head -n -1 | tail -n +2)
fi

# Generate comprehensive English documentation
cat > "docs/en/tasks/task-${TASK_ID}-${TASK_FEATURE,,}.md" << EOF
# ${TASK_TITLE}

**Task ID:** ${TASK_ID}  
**Feature:** ${TASK_FEATURE}  
**Status:** ${TASK_STATUS}  
**Commit Type:** ${TASK_COMMIT_TYPE}  
**Completed:** ${TIMESTAMP}  
**Source:** ${TASK_PATH}

## Version Information

**Project Version:** ${project_version}  
**Documentation Version:** ${new_doc_version}  
**Magic Vibe System:** v${magic_vibe_version}  
**Generation #:** ${new_count}

## Overview

${TASK_DESCRIPTION:-"Task completed successfully as part of the ${TASK_FEATURE} feature implementation."}

## Implementation Details

${TASK_DETAILS:-"Implementation details were completed according to task specifications."}

## Testing and Verification

${TEST_STRATEGY:-"Task was completed and verified according to the defined acceptance criteria."}

## Technical Changes

- Task implementation completed
- Code changes committed to repository
- Documentation automatically generated
- Integration with existing codebase verified

## Related Documentation

- [Feature Documentation](../features/${TASK_FEATURE,,}.md)
- [Project Overview](../README.md)
- [Russian Version](../../ru/tasks/task-${TASK_ID}-${TASK_FEATURE,,}.md)

---

*Auto-generated by Magic Vibe system on ${TIMESTAMP}*
EOF

# Generate comprehensive Russian documentation
cat > "docs/ru/tasks/task-${TASK_ID}-${TASK_FEATURE,,}.md" << EOF
# ${TASK_TITLE}

**ID задачи:** ${TASK_ID}  
**Функциональность:** ${TASK_FEATURE}  
**Статус:** ${TASK_STATUS}  
**Тип коммита:** ${TASK_COMMIT_TYPE}  
**Завершено:** ${TIMESTAMP}  
**Источник:** ${TASK_PATH}

## Информация о версии

**Версия проекта:** ${project_version}  
**Версия документации:** ${new_doc_version}  
**Система Magic Vibe:** v${magic_vibe_version}  
**Номер генерации:** ${new_count}

## Обзор

${TASK_DESCRIPTION:-"Задача успешно завершена в рамках реализации функциональности ${TASK_FEATURE}."}

## Детали реализации

${TASK_DETAILS:-"Детали реализации были выполнены согласно спецификациям задачи."}

## Тестирование и верификация

${TEST_STRATEGY:-"Задача была завершена и проверена согласно определенным критериям приемки."}

## Технические изменения

- Реализация задачи завершена
- Изменения в коде зафиксированы в репозитории
- Документация автоматически сгенерирована
- Интеграция с существующей кодовой базой проверена

## Связанная документация

- [Документация функциональности](../features/${TASK_FEATURE,,}.md)
- [Обзор проекта](../README.md)
- [Английская версия](../../en/tasks/task-${TASK_ID}-${TASK_FEATURE,,}.md)

---

*Автоматически сгенерировано системой Magic Vibe v${magic_vibe_version} ${TIMESTAMP}*
EOF

# Update English documentation index
if ! grep -q "## Task ${TASK_ID}:" "docs/en/README.md"; then
    sed -i "/## Recent Updates/a\\
\\
### Task ${TASK_ID}: ${TASK_TITLE}\\
**Completed:** ${TIMESTAMP}  \\
**Feature:** ${TASK_FEATURE}  \\
**Type:** ${TASK_COMMIT_TYPE}  \\
**Documentation Version:** ${new_doc_version}  \\
\\
[View Documentation](tasks/task-${TASK_ID}-${TASK_FEATURE,,}.md)" "docs/en/README.md"
fi

# Update Russian documentation index
if ! grep -q "## Задача ${TASK_ID}:" "docs/ru/README.md"; then
    sed -i "/## Последние обновления/a\\
\\
### Задача ${TASK_ID}: ${TASK_TITLE}\\
**Завершено:** ${TIMESTAMP}  \\
**Функциональность:** ${TASK_FEATURE}  \\
**Тип:** ${TASK_COMMIT_TYPE}  \\
**Версия документации:** ${new_doc_version}  \\
\\
[Посмотреть документацию](tasks/task-${TASK_ID}-${TASK_FEATURE,,}.md)" "docs/ru/README.md"
fi

echo "✅ Comprehensive documentation generated for task ${TASK_ID}: ${TASK_TITLE}"
echo "📁 English: docs/en/tasks/task-${TASK_ID}-${TASK_FEATURE,,}.md"
echo "📁 Russian: docs/ru/tasks/task-${TASK_ID}-${TASK_FEATURE,,}.md"
echo "📝 Documentation indexes updated"
echo "🏷️ Documentation version: ${new_doc_version} (Generation #${new_count})"
echo "📊 Project version: ${project_version}"
```
